*pyrepl.txt*  Python REPL for Neovim (pyrepl.nvim by dangooddd)

==============================================================================
INTRODUCTION                                                     *pyrepl*

pyrepl.nvim is a Python REPL inside Neovim powered by the Jupyter kernel stack.
It opens jupyter-console in a terminal split, lets you send code from buffers,
and displays image outputs.

Project: https://github.com/dangooddd/pyrepl.nvim

==============================================================================
REQUIREMENTS                                                   *pyrepl-reqs*

- A working Python executable. By default pyrepl.nvim uses `python` from PATH.
  You can override it with `python_path` (see |pyrepl-config|).
- The selected Python interpreter must have these packages:
  - pynvim
  - jupyter-console
- Optional for images:
  - pillow (JPEG -> PNG conversion)
  - cairosvg (SVG -> PNG conversion)
- A Jupyter kernel is registered (optional, for global kernels):

>
  python3 -m pip install ipykernel
  python3 -m ipykernel install --user --name python3
<

- Image rendering requires kitty graphics protocol (unicode placeholders).

Tree-sitter note: by default (`style_treesitter = true`) pyrepl.nvim derives
Pygments color overrides from current Neovim/Tree-sitter highlights.
It can also help with pasted Python normalization when the parser is available,
but Tree-sitter is not a hard requirement.

==============================================================================
COMMANDS                                                        *pyrepl-commands*

:PyreplOpen                                                     *PyreplOpen*
    Open (or show) the REPL. On first run you'll get a prompt to select a
    Jupyter kernel. The REPL opens in a terminal split.

    Notes:
    - pyrepl.nvim keeps one active REPL session.
    - Closing the REPL via |PyreplClose| shuts down the kernel.
    - Closing the REPL terminal window hides the window; the kernel stays alive.

:PyreplHide                                                     *PyreplHide*
    Hide the REPL window. Keeps the REPL buffer and kernel alive.

:PyreplClose                                                    *PyreplClose*
    Close the REPL and shut down the kernel.

:PyreplSendVisual                                               *PyreplSendVisual*
    Send the last visual selection to the REPL.

:PyreplSendBlock                                                *PyreplSendBlock*
    Send the "block" around the cursor. Blocks are separated by lines matching
    `block_pattern` (default: `^# %%%%.*$`, i.e. `# %%` like in notebooks).

:PyreplBlockForward                                             *PyreplBlockForward*
    Move cursor to the start of the next block (using `block_pattern`
    separators).

:PyreplBlockBackward                                            *PyreplBlockBackward*
    Move cursor to the start of the previous block (using `block_pattern`
    separators).

:PyreplSendBuffer                                               *PyreplSendBuffer*
    Send the entire buffer to the REPL.

:PyreplOpenImages                                               *PyreplOpenImages*
    Open the image manager (history of recent images).

:PyreplInstall {tool}                                           *PyreplInstall*
    Install pyrepl runtime packages into the configured Python interpreter.
    Supported tools:
      - pip: `<python_path> -m pip install jupyter-console pynvim`
      - uv:  `uv pip install -p <python_path> jupyter-console pynvim`


==============================================================================
LUA API                                                         *pyrepl-api*

require("pyrepl").setup({opts})                                 *pyrepl.setup*
    Configure pyrepl.nvim and create user commands.
    Returns the module table.

require("pyrepl").open_repl()                                   *pyrepl.open_repl*
    Same as |PyreplOpen|. Opens (or shows) the REPL.

require("pyrepl").hide_repl()                                   *pyrepl.hide_repl*
    Same as |PyreplHide|. Hides the REPL window.

require("pyrepl").close_repl()                                  *pyrepl.close_repl*
    Same as |PyreplClose|. Closes the REPL and shuts down the kernel.

require("pyrepl").send_block()                                  *pyrepl.send_block*
    Same as |PyreplSendBlock|. Sends the block around the cursor.

require("pyrepl").block_forward()                               *pyrepl.block_forward*
    Same as |PyreplBlockForward|. Jumps to the next block.

require("pyrepl").block_backward()                              *pyrepl.block_backward*
    Same as |PyreplBlockBackward|. Jumps to the previous block.

require("pyrepl").send_visual()                                 *pyrepl.send_visual*
    Same as |PyreplSendVisual|. Uses the '< and '> marks, so it maps nicely as
    `:<C-u>PyreplSendVisual<CR>gv`.

require("pyrepl").send_buffer()                                 *pyrepl.send_buffer*
    Same as |PyreplSendBuffer|. Sends the entire buffer.

require("pyrepl").open_images()                                 *pyrepl.open_images*
    Same as |PyreplOpenImages|. Opens the image manager.

require("pyrepl").install_packages({tool})                      *pyrepl.install_packages*
    Same as |PyreplInstall|. {tool} is "pip" or "uv".


==============================================================================
CONFIGURATION                                                   *pyrepl-config*

Default configuration:
>
  require("pyrepl").setup({
    split_horizontal = false,
    split_ratio = 0.5,
    style = "default",
    style_treesitter = true,
    image_max_history = 10,
    image_width_ratio = 0.5,
    image_height_ratio = 0.5,
    block_pattern = "^# %%%%.*$",
    python_path = "python",
    preferred_kernel = "python3",
  })
<

Options:
  split_horizontal (boolean)
      Use a horizontal split for the REPL terminal. Default: false.
  split_ratio (number)
      Fraction of screen used by the REPL split. Default: 0.5.
  style (string)
      Pygments style name used by jupyter-console. Default: "default".
      Used directly when `style_treesitter` is false.
  style_treesitter (boolean)
      Derive Pygments style overrides from current Neovim/Tree-sitter
      highlight groups for REPL output. Default: true.
      Set to false to use built-in Pygments styles from `style`.
  image_max_history (integer)
      Maximum number of images kept in history. Default: 10. Minimum: 2.
  image_width_ratio (number)
      Target image width as a fraction of editor columns. Default: 0.5.
      Used for sizing the render box and can upscale images.
  image_height_ratio (number)
      Target image height as a fraction of editor lines. Default: 0.5.
      Used for sizing the render box and can upscale images.
  block_pattern (string)
      Lua pattern used as block separators for |PyreplSendBlock|,
      |PyreplBlockForward| and |PyreplBlockBackward|.
      Default: "^# %%%%.*$".
  python_path (string)
      Python interpreter used by pyrepl.nvim. Default: "python".
      Resolution order is: `python_path`, then `g:python3_host_prog`, then
      `python` from PATH.
  preferred_kernel (string)
      Kernel name moved to the first position in the kernel picker.
      Default: "python3".

Python interpreter notes:
- Default behavior (`python_path = "python"`): if Neovim runs inside a venv,
  pyrepl.nvim usually uses that venv's Python.
- For one global interpreter, the old `~/.venv_nvim` setup still works:
>
  require("pyrepl").setup({
    python_path = "~/.venv_nvim/bin/python",
  })
<

Example with keymaps:
>
  {
      "dangooddd/pyrepl.nvim",
      dependencies = {
          "nvim-treesitter/nvim-treesitter",
        },
      config = function()
          local pyrepl = require("pyrepl")

          pyrepl.setup({
              style_treesitter = false,
              style = "gruvbox-dark",
              python_path = "python",
              preferred_kernel = "python3",
          })

          vim.keymap.set("n", "<leader>jo", ":PyreplOpen<CR>", { silent = true })
          vim.keymap.set("n", "<leader>jh", ":PyreplHide<CR>", { silent = true })
          vim.keymap.set("n", "<leader>jc", ":PyreplClose<CR>", { silent = true })
          vim.keymap.set("n", "<leader>js", ":PyreplSendBlock<CR>", { silent = true })
          vim.keymap.set("n", "<leader>jb", ":PyreplSendBuffer<CR>", { silent = true })
          vim.keymap.set("v", "<leader>jv", ":<C-u>PyreplSendVisual<CR>gv", { silent = true })
          vim.keymap.set("n", "<leader>ji", ":PyreplOpenImages<CR>", { silent = true })
      end,
  }
<

==============================================================================
TIPS                                                           *pyrepl-tips*

If Tree-sitter-based REPL colors do not match your preference, disable it and
use a built-in Pygments style:
>
  require("pyrepl").setup({
      style_treesitter = false,
      style = "default",
  })
<

Use any built-in Pygments style name in `style` (for example "gruvbox-dark").

Send block and jump forward in one mapping:
>
  vim.keymap.set("n", "<leader>jb", function()
      vim.cmd("PyreplSendBlock")
      vim.cmd("PyreplBlockForward")
  end)
<

Dedicated Python environment example:
>
  uv venv ~/.venv_nvim
  source ~/.venv_nvim/bin/activate
  uv pip install pynvim jupyter-console ipykernel
  uv pip install pillow cairosvg

  require("pyrepl").setup({
    python_path = "~/.venv_nvim/bin/python",
  })
<

See also |pyrepl-config| for interpreter resolution details.

==============================================================================
IMAGES                                                         *pyrepl-images*

Image rendering uses kitty graphics protocol with unicode placeholders.
Supported input formats from Jupyter are PNG, JPEG and SVG. JPEG/SVG are
converted to PNG (requires pillow/cairosvg).

Compatible terminals are listed in kitty's documentation (see README).
If you run via SSH/tmux, your terminal must pass through graphics APC sequences.

You can open the image manager with:
>
  require("pyrepl").open_images()
<
The image manager shows up to `image_max_history` recent images (default: 10).
The window displays a title showing current image position (e.g., "History 3/10").

While focused in the image window:
  j, h     previous image (both keys work)
  k, l     next image (both keys work)
  dd       delete current image from history
  q        close window
  <Esc>    close window

==============================================================================
HIGHLIGHTS                                                     *pyrepl-highlights*

pyrepl.nvim defines these highlight groups (linked by default):
  PyreplImageBorder
  PyreplImageTitle
  PyreplImageNormal

Override example:
>
  vim.api.nvim_set_hl(0, "PyreplImageBorder", { link = "FloatBorder" })
  vim.api.nvim_set_hl(0, "PyreplImageTitle", { link = "FloatTitle" })
  vim.api.nvim_set_hl(0, "PyreplImageNormal", { link = "NormalFloat" })
<

==============================================================================
TROUBLESHOOTING                                                *pyrepl-troubleshooting*

 - Ensure pyrepl.nvim can resolve a Python executable.
   If needed, set:

>
  require("pyrepl").setup({ python_path = "/path/to/python3" })
<

 - Install required Python packages into that interpreter (see |pyrepl-reqs|).
   You can use |PyreplInstall| with `pip` or `uv`.
<
 - If images do not render, verify kitty graphics protocol support in your
   terminal and pass-through over tmux is enabled.

==============================================================================
END

vim:tw=78:ts=8:noet:ft=help:norl:
