*pyrepl.txt*  Python REPL for Neovim (pyrepl.nvim by dangooddd)

==============================================================================
INTRODUCTION                                                     *pyrepl*

pyrepl.nvim is a Python REPL inside Neovim powered by Jupyter kernels. It opens
`jupyter-console` UI in a terminal split and provides commands to send
code from your buffer to the selected kernel.

pyrepl.nvim aims to provide a sensible workflow for Python REPL. It started as
a fork of pyrola.nvim (https://github.com/robitx/pyrola.nvim).

Main goals:
- Ability to send code from buffer to REPL
- Ability to display images in Neovim directly
- Balance code complication with sensible features for REPL workflow

Features:
- Convert notebook files from and to python with `jupytext`
- Install all runtime deps required with command (no need to install kernel
globally with default settings)
- Use `jupyter-console` TUI for REPL
- Prompt user to choose jupyter kernel on REPL start
- Send code to the REPL from current buffer
- Automatically display output images and save them to image history.
- Neovim theme integration for `jupyter-console`

------------------------------------------------------------------------------
QUICKSTART                                                  *pyrepl-quickstart*

Minimal lazy.nvim setup with the default config and example keymaps:
>
  {
    "dangooddd/pyrepl.nvim",
    dependencies = { "nvim-treesitter/nvim-treesitter" },
    config = function()
      require("pyrepl").setup({
        -- defaults (you can omit these):
        split_horizontal = false,
        split_ratio = 0.5,
        style_treesitter = true,
        image_max_history = 10,
        image_width_ratio = 0.5,
        image_height_ratio = 0.5,
	-- built-in provider, works best for ghostty and kitty
	-- for other terminals use "image" instead of "placeholders"
	image_provider = "placeholders",
        block_pattern = "^# %%%%.*$",
        python_path = "python",
        preferred_kernel = "python3",
        jupytext_hook = true,
      })

      -- main commands
      vim.keymap.set("n", "<leader>jo", ":PyreplOpen<CR>", { silent = true })
      vim.keymap.set("n", "<leader>jh", ":PyreplHide<CR>", { silent = true })
      vim.keymap.set("n", "<leader>jc", ":PyreplClose<CR>", { silent = true })
      vim.keymap.set("n", "<leader>ji", ":PyreplOpenImages<CR>", { silent = true })

      -- send commands
      vim.keymap.set("n", "<leader>jb", ":PyreplSendBlock<CR>", { silent = true })
      vim.keymap.set("n", "<leader>jf", ":PyreplSendBuffer<CR>", { silent = true })
      vim.keymap.set("v", "<leader>jv", ":<C-u>PyreplSendVisual<CR>gv<Esc>", { silent = true })

      -- utility commands
      vim.keymap.set("n", "<leader>jp", ":PyreplBlockBackward<CR>", { silent = true })
      vim.keymap.set("n", "<leader>jn", ":PyreplBlockForward<CR>", { silent = true })
      vim.keymap.set("n", "<leader>je", ":PyreplExport<CR>", { silent = true })
      vim.keymap.set("n", "<leader>js", ":PyreplInstall")
    end,
  }
<

Then install pyrepl runtime packages with `uv` or `pip` directly from Neovim:
>
  :PyreplInstall pip
  :PyreplInstall uv
<

==============================================================================
REQUIREMENTS                                                   *pyrepl-reqs*

- A working Python executable. By default pyrepl.nvim uses `python` from PATH.
  You can override it with `python_path` (see |pyrepl-config|).
- The selected Python interpreter must have these packages:
  - pynvim
  - jupyter-console
- Optional for images:
  - pillow (JPEG -> PNG conversion)
  - cairosvg (SVG -> PNG conversion)
- A Jupyter kernel is registered (optional, for global kernels):

>
  python3 -m pip install ipykernel
  python3 -m ipykernel install --user --name python3
<

==============================================================================
KNOWN LIMITATIONS                                          *pyrepl-limitations*

- Only Python is officially supported and will be prioritized. For R, see
  https://github.com/R-nvim/R.nvim
- Persistence in kernel outputs is not possible right now. Implementing cell
  logic like `molten.nvim` will complicate current approach

==============================================================================
COMMANDS                                                        *pyrepl-commands*

:PyreplOpen                                                     *PyreplOpen*
    Open (or show) the REPL. On first run you'll get a prompt to select a
    Jupyter kernel. The REPL opens in a terminal split.

    Notes:
    - pyrepl.nvim keeps one active REPL session.
    - Closing the REPL via |PyreplClose| shuts down the kernel.
    - Closing the REPL terminal window hides the window; the kernel stays alive.

:PyreplHide                                                     *PyreplHide*
    Hide the REPL window. Keeps the REPL buffer and kernel alive.

:PyreplClose                                                    *PyreplClose*
    Close the REPL and shut down the kernel.

:PyreplSendVisual                                               *PyreplSendVisual*
    Send the last visual selection to the REPL.

:PyreplSendBlock                                                *PyreplSendBlock*
    Send the "block" around the cursor (by default blocks are separated by lines
    matching `# %% ...`; configure via `block_pattern`).

:PyreplBlockForward                                             *PyreplBlockForward*
    Move cursor to the start of the next block separated by `block_pattern`.

:PyreplBlockBackward                                            *PyreplBlockBackward*
    Move cursor to the start of the previous block separated by `block_pattern`.

:PyreplSendBuffer                                               *PyreplSendBuffer*
    Send the entire buffer to the REPL.

:PyreplOpenImages                                               *PyreplOpenImages*
    Open the image manager (history of recent images). Use `j`/`h` for previous,
    `k`/`l` for next, `dd` to delete, `q` or `<Esc>` to close.

:PyreplExport                                                   *PyreplExport*
    Export current buffer using `jupytext` (should be installed).

:PyreplConvert                                                  *PyreplConvert*
    Prompt to convert current notebook buffer using `jupytext` (should be installed).
    Helpful only when `config.jupytext_hook` is `false`.

:PyreplInstall {tool}                                           *PyreplInstall*
    Install pyrepl runtime packages into the configured Python interpreter.
    Supported tools:
      - pip: `<python_path> -m pip install jupyter-console pynvim`
      - uv:  `uv pip install -p <python_path> jupyter-console pynvim`


==============================================================================
LUA API                                                         *pyrepl-api*

require("pyrepl").setup({opts})                                 *pyrepl.setup*
    Configure pyrepl.nvim and create user commands.
    Returns the module table.

require("pyrepl").open_repl()                                   *pyrepl.open_repl*
    Same as |PyreplOpen|. Opens (or shows) the REPL.

require("pyrepl").hide_repl()                                   *pyrepl.hide_repl*
    Same as |PyreplHide|. Hides the REPL window.

require("pyrepl").close_repl()                                  *pyrepl.close_repl*
    Same as |PyreplClose|. Closes the REPL and shuts down the kernel.

require("pyrepl").send_block()                                  *pyrepl.send_block*
    Same as |PyreplSendBlock|. Sends the block around the cursor.

require("pyrepl").block_forward()                               *pyrepl.block_forward*
    Same as |PyreplBlockForward|. Jumps to the next block.

require("pyrepl").block_backward()                              *pyrepl.block_backward*
    Same as |PyreplBlockBackward|. Jumps to the previous block.

require("pyrepl").send_visual()                                 *pyrepl.send_visual*
    Same as |PyreplSendVisual|. Uses the '< and '> marks, so it maps nicely as
    `:<C-u>PyreplSendVisual<CR>gv` (`gv` to place cursor at visual range end).

require("pyrepl").send_buffer()                                 *pyrepl.send_buffer*
    Same as |PyreplSendBuffer|. Sends the entire buffer.

require("pyrepl").open_images()                                 *pyrepl.open_images*
    Same as |PyreplOpenImages|. Opens the image manager.

require("pyrepl").export_notebook()                             *pyrepl.export_notebook*
    Same as |PyreplExport|. Exports buffer to notebook format.

require("pyrepl").convert_notebook_guarded()                    *pyrepl.convert_notebook_guarded*
    Same as |PyreplConvert|. Converts notebook to `py:percent` format.

require("pyrepl").install_packages({tool})                      *pyrepl.install_packages*
    Same as |PyreplInstall|. {tool} is "pip" or "uv".


==============================================================================
CONFIGURATION                                                   *pyrepl-config*

Default configuration:
>
  require("pyrepl").setup({
    split_horizontal = false,
    split_ratio = 0.5,
    style_treesitter = true,
    image_max_history = 10,
    image_width_ratio = 0.5,
    image_height_ratio = 0.5,
    image_provider = "placeholders",
    block_pattern = "^# %%%%.*$",
    python_path = "python",
    preferred_kernel = "python3",
    jupytext_hook = true,
  })
<

Options:
  split_horizontal (boolean)
      Use a horizontal split for the REPL terminal. Default: false.
  split_ratio (number)
      Fraction of screen used by the REPL split. Default: 0.5.
  style (string)
      Pygments style name used by jupyter-console. Default: "default".
      Used directly when `style_treesitter` is false.
  style_treesitter (boolean)
      Derive Pygments style overrides from current Neovim/Tree-sitter
      highlight groups for REPL output. Default: true.
      Set to false to use built-in Pygments styles from `style`.
  image_max_history (integer)
      Maximum number of images kept in history. Default: 10. Minimum: 2.
  image_width_ratio (number)
      Target image width as a fraction of editor columns. Default: 0.5.
      Used for sizing the render box and can upscale images.
  image_height_ratio (number)
      Target image height as a fraction of editor lines. Default: 0.5.
      Used for sizing the render box and can upscale images.
  image_provider (string)
      Use "placeholders" for ghostty and kitty terminals.
      Use "image" for other terminals, you should configure `image.nvim`
      plugin.
  block_pattern (string)
      Lua pattern used as block separators for |PyreplSendBlock|,
      |PyreplBlockForward| and |PyreplBlockBackward|.
      Default: "^# %%%%.*$".
  python_path (string)
      Python interpreter used by pyrepl.nvim. Default: "python".
      Resolution order is: `python_path`, then `g:python3_host_prog`, then
      `python` from PATH.
  preferred_kernel (string)
      Kernel name moved to the first position in the kernel picker.
      Default: "python3".
  jupytext_hook (boolean)
      Enable jupytext hook to automatically convert notebook buffers to `py:percent`. Default: true.

==============================================================================
TIPS & TRICKS                                                  *pyrepl-tips*

Image display ~

If you use ghostty (https://github.com/ghostty-org/ghostty) or kitty
(https://github.com/kovidgoyal/kitty), do not change default provider
"placeholders" - it works better and tested in various cases, like ssh + tmux +
docker.

Only if you use other terminals, change provider to "image" - in this case
pyrepl will use image.nvim (https://github.com/3rd/image.nvim) image provider.
For example, to display images in terminal with `sixel` protocol support:
>
  {
    "3rd/image.nvim",
    config = function()
      require("image").setup({
        backend = "sixel",
      })
    end,
  },

  {
    "dangooddd/pyrepl.nvim",
    dependencies = { "nvim-treesitter/nvim-treesitter" },
    config = function()
      require("pyrepl").setup({
        image_provider = "image",
      })
    end,
  }
<

Use a dedicated Python environment ~

- By default pyrepl.nvim uses `python` (`python_path = "python"`). If Neovim is
  started inside a venv, that venv is usually used.
- For one dedicated interpreter, set `python_path` directly (or set
  `python_path = nil` to use `vim.g.python3_host_prog`).

Example dedicated interpreter workflow:
>
  uv venv ~/.venv_nvim
  source ~/.venv_nvim/bin/activate
  uv pip install pynvim jupyter-console ipykernel
  uv pip install pillow cairosvg # optional, for jpg and svg support

  require("pyrepl").setup({
    python_path = "~/.venv_nvim/bin/python",
  })
<

If to use this workflow you need to install kernels globally:
>
  # from kernel virtual environment
  python -m ipykernel install --user --name {kernel_name}
<

Use a built-in Pygments style instead ~

If you do not like the treesitter-based REPL colors, disable it and pick a
built-in Pygments theme:
>
  require("pyrepl").setup({
    style_treesitter = false,
    style = "default", -- or another Pygments style, e.g. "gruvbox-dark"
  })
<

Send block and move to the next one ~

Combine "send" and "block" commands:
>
  vim.keymap.set("n", "<leader>jb", function()
    vim.cmd("PyreplSendBlock")
    vim.cmd("PyreplBlockForward")
  end)
<

See also |pyrepl-config| for interpreter resolution details.

==============================================================================
IMAGES                                                         *pyrepl-images*

Image rendering uses kitty graphics protocol with unicode placeholders.
Supported input formats from Jupyter are PNG, JPEG and SVG. JPEG/SVG are
converted to PNG (requires pillow/cairosvg).

Compatible terminals are listed in kitty's documentation (see README).
If you run via SSH/tmux, your terminal must pass through graphics APC sequences.

You can open the image manager with:
>
  require("pyrepl").open_images()
<
The image manager shows up to `image_max_history` recent images (default: 10).
The window displays a title showing current image position (e.g., "History 3/10").

While focused in the image window:
  j, h     previous image (both keys work)
  k, l     next image (both keys work)
  dd       delete current image from history
  q        close window
  <Esc>    close window

==============================================================================
HIGHLIGHTS                                                     *pyrepl-highlights*

pyrepl.nvim defines these highlight groups:
  PyreplImageBorder
  PyreplImageTitle
  PyreplImageNormal

Default links:
>
  vim.api.nvim_set_hl(0, "PyreplImageBorder", { link = "FloatBorder" })
  vim.api.nvim_set_hl(0, "PyreplImageTitle", { link = "FloatTitle" })
  vim.api.nvim_set_hl(0, "PyreplImageNormal", { link = "NormalFloat" })
<

==============================================================================
TROUBLESHOOTING                                                *pyrepl-troubleshooting*

 - Ensure pyrepl.nvim can resolve a Python executable.
   If needed, set:

>
  require("pyrepl").setup({ python_path = "/path/to/python3" })
<

 - Install required Python packages into that interpreter (see |pyrepl-reqs|).
   You can use |PyreplInstall| with `pip` or `uv`.
<
 - If images do not render, verify kitty graphics protocol support in your
   terminal and pass-through over tmux is enabled.
   If you use `image` provider, upstream issue.

==============================================================================
END

vim:tw=78:ts=8:noet:ft=help:norl:
