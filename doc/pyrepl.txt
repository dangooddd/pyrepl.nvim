*pyrepl.txt*  Python REPL for Neovim (pyrepl.nvim by dangooddd)

==============================================================================
INTRODUCTION                                                     *pyrepl*

pyrepl.nvim is a Python REPL inside Neovim powered by the Jupyter kernel stack.
It opens jupyter-console in a terminal split, lets you send code from buffers,
and (on supported terminals) displays image outputs.

Project: https://github.com/dangooddd/pyrepl.nvim

==============================================================================
REQUIREMENTS                                                   *pyrepl-reqs*

- Neovim Python provider is configured (see |provider-python|).
- The Python interpreter set in `g:python3_host_prog` must have these packages:
  - pynvim
  - jupyter-client
  - jupyter-console
  - ipykernel
- Optional for images:
  - pillow (JPEG -> PNG conversion)
  - cairosvg (SVG -> PNG conversion)
- A Jupyter kernel is registered (example):
>
  python3 -m pip install ipykernel
  python3 -m ipykernel install --user --name python3
<
- This is a remote plugin: after installation run `:UpdateRemotePlugins` and
  restart Neovim.
- Image rendering requires kitty graphics protocol (unicode placeholders).

Tree-sitter note: the plugin can use Tree-sitter to normalize pasted Python
more reliably (when the parser is available), but it is not a hard requirement.

==============================================================================
COMMANDS                                                        *pyrepl-commands*

:PyreplOpen                                                     *PyreplOpen*
    Open (or show) the REPL for the current buffer. On first run you'll get a
    prompt to select a Jupyter kernel. The REPL opens in a terminal split.
    Each buffer gets its own kernel session.

    Notes:
    - Buffer-local command (availability is controlled by the `filetypes` option).
    - Requires `:UpdateRemotePlugins` after installation.
    - Closing the REPL via |PyreplClose| shuts down the kernel.
    - Closing the REPL terminal window hides the window; the kernel stays alive.

:PyreplHide                                                     *PyreplHide*
    Hide the REPL window for the current buffer. Keeps the REPL buffer and
    kernel alive.

:PyreplClose                                                    *PyreplClose*
    Close the REPL for the current buffer and shut down the kernel.

:PyreplSendVisual                                               *PyreplSendVisual*
    Send the last visual selection to the REPL.

:PyreplSendBlock                                                *PyreplSendBlock*
    Send the "block" around the cursor. Blocks are separated by lines matching
    `block_pattern` (default: `^# %%%%.*$`, i.e. `# %%` like in notebooks).

:PyreplSendBuffer                                               *PyreplSendBuffer*
    Send the entire buffer to the REPL.

:PyreplOpenImages                                               *PyreplOpenImages*
    Open the image manager (history of recent images).


==============================================================================
LUA API                                                         *pyrepl-api*

require("pyrepl").setup({opts})                                 *pyrepl.setup*
    Configure pyrepl.nvim. Commands are registered buffer-locally on FileType.
    Returns the module table.

require("pyrepl").open_repl([{buf}])                             *pyrepl.open_repl*
    Same as |PyreplOpen|. Opens the REPL for a buffer (current by default).

require("pyrepl").hide_repl([{buf}])                             *pyrepl.hide_repl*
    Same as |PyreplHide|. Hides the REPL window.

require("pyrepl").close_repl([{buf}])                            *pyrepl.close_repl*
    Same as |PyreplClose|. Closes the REPL and shuts down the kernel.

require("pyrepl").send_block([{buf}])                            *pyrepl.send_block*
    Same as |PyreplSendBlock|. Sends the block around the cursor.

require("pyrepl").send_visual([{buf}])                           *pyrepl.send_visual*
    Same as |PyreplSendVisual|. Uses the '< and '> marks, so it maps nicely as
    `:<C-u>PyreplSendVisual<CR>gv`.

require("pyrepl").send_buffer([{buf}])                           *pyrepl.send_buffer*
    Same as |PyreplSendBuffer|. Sends the entire buffer.

require("pyrepl").open_images()                                 *pyrepl.open_images*
    Same as |PyreplOpenImages|. Opens the image manager.

require("pyrepl").get_config()                                  *pyrepl.get_config*
    Return the current configuration table (read-only).


==============================================================================
CONFIGURATION                                                   *pyrepl-config*

Default configuration:
>
  require("pyrepl").setup({
    split_horizontal = false,
    split_ratio = 0.5,
    style = "default",
    image_width_ratio = 0.4,
    image_height_ratio = 0.5,
    filetypes = nil,
    block_pattern = "^# %%%%.*$",
  })
<

Options:
  split_horizontal (boolean)
      Use a horizontal split for the REPL terminal. Default: false.
  split_ratio (number)
      Fraction of screen used by the REPL split. Default: 0.5.
  style (string)
      Pygments style name for REPL syntax highlighting. Default: "default".
  image_width_ratio (number)
      Target image width as a fraction of editor columns. Default: 0.4.
      Used for sizing the render box and can upscale images.
  image_height_ratio (number)
      Target image height as a fraction of editor lines. Default: 0.5.
      Used for sizing the render box and can upscale images.
  filetypes (table|nil)
      List of filetypes on which pyrepl.nvim commands are available.
      Default: nil (enabled for all).
  block_pattern (string)
      Lua pattern used as block separators for |PyreplSendBlock|.
      Default: "^# %%%%.*$".

Example with keymaps:
>
  {
      "dangooddd/pyrepl.nvim",
      dependencies = {
          "nvim-treesitter/nvim-treesitter",
        },
      build = ":UpdateRemotePlugins",
      config = function()
          local pyrepl = require("pyrepl")

          pyrepl.setup({
              style = "gruvbox-dark",
          })

          vim.keymap.set("n", "<leader>jo", ":PyreplOpen<CR>", { silent = true })
          vim.keymap.set("n", "<leader>jh", ":PyreplHide<CR>", { silent = true })
          vim.keymap.set("n", "<leader>jc", ":PyreplClose<CR>", { silent = true })
          vim.keymap.set("n", "<leader>js", ":PyreplSendBlock<CR>", { silent = true })
          vim.keymap.set("n", "<leader>jb", ":PyreplSendBuffer<CR>", { silent = true })
          vim.keymap.set("v", "<leader>jv", ":<C-u>PyreplSendVisual<CR>gv", { silent = true })
          vim.keymap.set("n", "<leader>ji", ":PyreplOpenImages<CR>", { silent = true })
      end,
  }
<

==============================================================================
IMAGES                                                         *pyrepl-images*

Image rendering uses kitty graphics protocol with unicode placeholders.
Supported input formats from Jupyter are PNG, JPEG and SVG. JPEG/SVG are
converted to PNG (requires pillow/cairosvg).

Compatible terminals are listed in kitty's documentation (see README).
If you run via SSH/tmux, your terminal must pass through graphics APC sequences.

You can open the image manager with:
>
  require("pyrepl").open_images()
<

While focused in the image window:
  h     previous image
  l     next image
  q     close window
  <Esc> close window

==============================================================================
HIGHLIGHTS                                                     *pyrepl-highlights*

pyrepl.nvim defines these highlight groups (linked by default):
  PyreplImageBorder
  PyreplImageTitle
  PyreplImageNormal

Override example:
>
  vim.api.nvim_set_hl(0, "PyreplImageBorder", { link = "FloatBorder" })
  vim.api.nvim_set_hl(0, "PyreplImageTitle", { link = "FloatTitle" })
  vim.api.nvim_set_hl(0, "PyreplImageNormal", { link = "NormalFloat" })
<

==============================================================================
TROUBLESHOOTING                                                *pyrepl-troubleshooting*

 - Ensure your Python provider is configured. If needed, set:
>
  let g:python3_host_prog = "/path/to/python3"
<
 - Install required Python packages into that interpreter (see |pyrepl-reqs|).
 - After installing, run `:UpdateRemotePlugins` and restart Neovim.
 - If kernels are not found, install ipykernel and register a kernel:
>
  python3 -m pip install ipykernel
  python3 -m ipykernel install --user --name python3
<
 - If images do not render, verify kitty graphics protocol support in your
   terminal and pass-through over SSH/tmux.

==============================================================================
END

vim:tw=78:ts=8:noet:ft=help:norl:
